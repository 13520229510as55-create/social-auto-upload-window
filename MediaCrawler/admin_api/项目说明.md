# MediaCrawler 管理后台项目说明

## 项目概述

这是一个为 MediaCrawler 爬虫项目开发的 Web 管理后台，提供了可视化的配置管理、任务管理和数据查看功能。

## 项目结构

```
admin_api/
├── main.py                 # 后端API主文件
├── login_service.py        # 登录服务模块
├── requirements.txt        # Python依赖
├── test_api.py            # API测试脚本
├── README.md              # 项目说明
├── QUICK_START.md         # 快速开始指南
├── start.sh               # 启动脚本
├── frontend/              # 前端项目
│   ├── package.json
│   ├── vite.config.js
│   ├── index.html
│   └── src/
│       ├── main.jsx       # 入口文件
│       ├── App.jsx        # 主应用组件
│       ├── components/    # 组件目录
│       │   ├── Layout.jsx      # 布局组件
│       │   └── QRCodeLogin.jsx # 二维码登录组件
│       ├── pages/         # 页面组件
│       │   ├── Dashboard.jsx   # 总览页面
│       │   ├── Config.jsx      # 配置页面
│       │   ├── Tasks.jsx      # 任务管理页面
│       │   ├── Data.jsx        # 数据列表页面
│       │   └── Login.jsx       # 登录页面
│       └── utils/
│           └── api.js      # API工具函数
└── cookies/               # Cookie存储目录（自动创建）
```

## 核心功能

### 1. 总览面板 (Dashboard)
- 显示各平台数据统计
- 显示任务运行状态
- 实时更新统计数据

### 2. 配置管理 (Config)
- 支持7个平台的独立配置
- 配置项包括：
  - 爬取类型（搜索/详情/创作者）
  - 关键词设置
  - 爬取数量限制
  - 评论爬取设置
  - 数据保存格式
  - 平台特定配置

### 3. 二维码登录
- 支持各平台二维码登录
- 自动保存Cookie
- Cookie自动复用（保存后无需重复登录）

### 4. 任务管理 (Tasks)
- 启动爬虫任务
- 查看任务状态
- 停止运行中的任务
- 实时更新任务进度

### 5. 数据列表 (Data)
- 查看各平台爬取的数据
- 支持搜索和分页
- 显示数据统计信息

## 技术栈

### 后端
- **FastAPI**: 现代、快速的Web框架
- **Python 3.8+**: 编程语言
- **Playwright**: 浏览器自动化（用于二维码登录）

### 前端
- **React 18**: UI框架
- **Ant Design 5**: UI组件库
- **Vite**: 构建工具
- **React Router**: 路由管理
- **Axios**: HTTP客户端

## API接口文档

### 平台相关
- `GET /api/platforms` - 获取支持的平台列表
- `GET /api/config/{platform}` - 获取平台配置
- `POST /api/config/{platform}` - 保存平台配置

### 登录相关
- `POST /api/login/qrcode?platform={platform}` - 获取登录二维码
- `GET /api/login/status/{qrcode_id}` - 检查登录状态
- `GET /api/login/cookie/{platform}` - 获取保存的Cookie

### 任务相关
- `POST /api/tasks/start` - 启动爬虫任务
- `GET /api/tasks` - 获取任务列表
- `GET /api/tasks/{task_id}` - 获取任务状态
- `DELETE /api/tasks/{task_id}` - 停止任务

### 数据相关
- `GET /api/data/{platform}` - 获取爬取的数据

### 统计相关
- `GET /api/dashboard/stats` - 获取总览统计数据

## 使用流程

1. **安装依赖**
   ```bash
   # 后端
   pip install -r requirements.txt
   
   # 前端
   cd frontend && npm install
   ```

2. **启动服务**
   ```bash
   # 后端
   python main.py
   
   # 前端（新终端）
   cd frontend && npm run dev
   ```

3. **访问管理后台**
   - 打开浏览器访问: http://localhost:3000

4. **配置和运行**
   - 配置平台参数
   - 登录平台（二维码）
   - 启动爬虫任务
   - 查看爬取数据

## 注意事项

1. **Cookie管理**
   - Cookie保存在 `cookies/` 目录
   - 每个平台的Cookie独立存储
   - 登录成功后自动保存，下次无需重新登录

2. **数据存储**
   - 爬取的数据保存在项目根目录的 `output/` 目录
   - 支持多种格式：JSON、CSV、Excel、数据库

3. **浏览器驱动**
   - 首次使用需要安装Playwright浏览器驱动
   - 运行: `playwright install`

4. **配置持久化**
   - 配置通过API保存到config模块
   - 建议在启动任务前保存配置

## 开发说明

### 添加新平台支持

1. 在 `main.py` 的 `get_platforms()` 中添加平台信息
2. 在 `login_service.py` 中添加平台的登录URL和选择器
3. 在前端 `Config.jsx` 中添加平台特定配置项

### 扩展功能

- 任务进度更新：可以在 `run_crawler()` 函数中添加进度回调
- 数据导出：可以在数据列表页面添加导出功能
- 定时任务：可以添加定时任务调度功能

## 测试

运行测试脚本：
```bash
python test_api.py
```

## 故障排除

1. **后端启动失败**
   - 检查Python版本（>= 3.8）
   - 检查依赖是否安装完整
   - 检查端口8000是否被占用

2. **前端启动失败**
   - 检查Node.js版本（>= 16.0.0）
   - 运行 `npm install` 重新安装依赖
   - 检查端口3000是否被占用

3. **二维码登录失败**
   - 确保已安装playwright浏览器驱动
   - 检查网络连接
   - 查看后端日志错误信息

4. **任务启动失败**
   - 检查是否已登录（有有效Cookie）
   - 检查配置是否正确
   - 查看后端日志错误信息

## 许可证

本项目遵循 MediaCrawler 项目的许可证。

