# 使用生产构建文件启动前端服务

## 发现的问题

之前使用 `npm run dev` 启动的是**开发服务器**，它加载的是源代码（`/src/main.js`），不是构建后的 `dist` 文件。

开发模式 HTML：
```html
<script type="module" src="/@vite/client"></script>
<script type="module" src="/src/main.js"></script>
```

生产模式 HTML（正确）：
```html
<script type="module" crossorigin src="/assets/index-DoKvP7U0.js"></script>
```

## 解决方案

### 方法1：使用 Vite Preview（已执行）

```cmd
cd C:\social-auto-upload-window\sau_frontend
npm run preview -- --host 0.0.0.0 --port 5173
```

这会启动一个静态文件服务器，服务 `dist` 目录中的文件。

### 方法2：使用 http-server（推荐用于生产）

```cmd
# 安装 http-server
npm install -g http-server

# 启动服务
cd C:\social-auto-upload-window\sau_frontend\dist
http-server -p 5173 -a 0.0.0.0
```

### 方法3：使用 Nginx（最佳生产方案）

**安装 Nginx for Windows：**
1. 下载：https://nginx.org/en/download.html
2. 解压到 `C:\nginx`

**配置 Nginx（`C:\nginx\conf\nginx.conf`）：**
```nginx
server {
    listen 5173;
    server_name localhost;
    
    root C:/social-auto-upload-window/sau_frontend/dist;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # API 代理
    location /api/ {
        proxy_pass http://localhost:5409/;
    }
}
```

**启动 Nginx：**
```cmd
cd C:\nginx
start nginx
```

### 方法4：使用 PM2 管理

```cmd
npm install -g pm2

cd C:\social-auto-upload-window\sau_frontend
pm2 start npm --name "sau-frontend" -- run preview -- --host 0.0.0.0 --port 5173
pm2 save
```

## 验证构建文件是否正确加载

访问 `http://39.105.227.6:5173/` 并查看源代码，应该看到：

```html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SAU自媒体自动化运营系统</title>
    <script type="module" crossorigin src="/assets/index-DoKvP7U0.js"></script>
    <link rel="modulepreload" crossorigin href="/assets/vue-Do6M885h.js">
    <link rel="modulepreload" crossorigin href="/assets/elementPlus-D2P9ZtLU.js">
    <link rel="modulepreload" crossorigin href="/assets/utils-B9ygI19o.js">
    <link rel="stylesheet" crossorigin href="/assets/index-BFyp6Lua.css">
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
```

## 访问配置管理页面

服务启动后，**使用无痕模式**访问：
```
http://39.105.227.6:5173/#/production/config
```

应该能看到：
- ✅ 3个Tab：图文、文章、视频
- ✅ 3个账号列表
- ✅ 无路由错误
- ✅ 页面功能正常

## start-win.bat 需要修改

如果想让 `start-win.bat` 使用生产构建，需要修改：

**修改前：**
```bat
START "SAU Frontend" cmd /k "cd sau_frontend && npm run dev -- --host 0.0.0.0"
```

**修改后：**
```bat
START "SAU Frontend" cmd /k "cd sau_frontend && npm run preview -- --host 0.0.0.0 --port 5173"
```

或者使用 http-server：
```bat
START "SAU Frontend" cmd /k "cd sau_frontend\dist && http-server -p 5173 -a 0.0.0.0"
```

## 当前状态

- ✅ 已停止开发服务器
- ✅ 已启动预览服务器（使用 dist 文件）
- ⏳ 等待服务启动完成（约10秒）

请稍等片刻，然后使用**无痕模式**访问页面。

---

时间：2025-12-24 22:55

